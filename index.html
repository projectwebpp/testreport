<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบรายงานการตรวจสอบและรับรองความปลอดภัยของระบบไฟฟ้าในโรงงาน</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'TH Sarabun New', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 25px 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .form-container {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            border: 1px solid #e1e5eb;
            border-radius: 8px;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .section-title {
            font-size: 1.4rem;
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a5298;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 1.2rem;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.2);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .signature-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .signature-area:hover {
            border-color: #2a5298;
            background-color: #f0f4ff;
        }
        
        .signature-area i {
            font-size: 2rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        .signature-preview {
            margin-top: 15px;
            max-width: 100%;
            max-height: 100px;
            display: none;
        }
        
        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
            justify-content: center;
        }
        
        .btn-save {
            background-color: #28a745;
            color: white;
        }
        
        .btn-save:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }
        
        .btn-pdf {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-pdf:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }
        
        .btn-clear {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-clear:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
            text-align: center;
            font-weight: 600;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .required::after {
            content: " *";
            color: #dc3545;
        }
        
        .instructions {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 25px;
            border-left: 5px solid #2a5298;
        }
        
        .instructions h3 {
            color: #1e3c72;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-file-contract"></i>
                <h1>แบบรายงานการตรวจสอบและรับรองความปลอดภัยของระบบไฟฟ้าในโรงงาน</h1>
            </div>
            <p>กรมโรงงานอุตสาหกรรม กระทรวงอุตสาหกรรม</p>
        </div>
        
        <div class="form-container">
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> คำแนะนำในการกรอกข้อมูล</h3>
                <p>1. กรุณากรอกข้อมูลให้ครบถ้วนทุกช่องที่มีเครื่องหมาย *</p>
                <p>2. หลังจากกรอกข้อมูลเสร็จเรียบร้อยแล้ว ให้คลิกปุ่ม "บันทึกลง Google Sheets" เพื่อบันทึกข้อมูล</p>
                <p>3. คลิกปุ่ม "สร้างไฟล์ PDF" เพื่อสร้างไฟล์รายงานในรูปแบบ PDF</p>
                <p>4. ข้อมูลจะถูกบันทึกตามแบบฟอร์มของกรมโรงงานอุตสาหกรรม</p>
            </div>
            
            <form id="inspectionForm">
                <!-- ส่วนข้อมูลทั่วไป -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-building"></i> ข้อมูลทั่วไป</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="companyName" class="required">ชื่อบริษัท/โรงงาน</label>
                            <input type="text" id="companyName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="companyAddress" class="required">ที่อยู่บริษัท/โรงงาน</label>
                            <textarea id="companyAddress" class="form-control" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="factoryName" class="required">ชื่อโรงงานที่ตรวจสอบ</label>
                            <input type="text" id="factoryName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="factoryType" class="required">ประเภทธุรกิจ</label>
                            <input type="text" id="factoryType" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="factorySize" class="required">ขนาดพื้นที่โรงงาน (ตร.ม.)</label>
                            <input type="number" id="factorySize" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="ownerName" class="required">ชื่อเจ้าของ/ผู้จัดการโรงงาน</label>
                            <input type="text" id="ownerName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="ownerPosition" class="required">ตำแหน่ง</label>
                            <input type="text" id="ownerPosition" class="form-control" required>
                        </div>
                    </div>
                </div>
                
                <!-- ส่วนข้อมูลการตรวจสอบ -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-clipboard-check"></i> ข้อมูลการตรวจสอบ</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="inspectorName" class="required">ชื่อผู้ตรวจสอบ</label>
                            <input type="text" id="inspectorName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="inspectionDate" class="required">วันที่ตรวจสอบ</label>
                            <input type="date" id="inspectionDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="nextInspectionDate" class="required">วันที่ตรวจสอบครั้งต่อไป</label>
                            <input type="date" id="nextInspectionDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="overallResult" class="required">ผลการตรวจสอบโดยรวม</label>
                            <select id="overallResult" class="form-control" required>
                                <option value="">-- กรุณาเลือก --</option>
                                <option value="ผ่าน">ผ่าน</option>
                                <option value="ผ่าน但有ปรับปรุง">ผ่าน但有ปรับปรุง</option>
                                <option value="ไม่ผ่าน">ไม่ผ่าน</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="recommendations" class="required">ข้อเสนอแนะ/สิ่งที่ต้องปรับปรุง</label>
                        <textarea id="recommendations" class="form-control" required></textarea>
                    </div>
                </div>
                
                <!-- ส่วนลายเซ็น -->
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-signature"></i> ลายเซ็นรับรอง</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="inspectorSignature" class="required">ลายเซ็นผู้ตรวจสอบ</label>
                            <div class="signature-area" id="inspectorSignatureArea">
                                <i class="fas fa-signature"></i>
                                <p>คลิกเพื่อเพิ่มลายเซ็นผู้ตรวจสอบ</p>
                                <canvas id="inspectorSignatureCanvas" width="400" height="150" style="display:none;"></canvas>
                                <img id="inspectorSignaturePreview" class="signature-preview" alt="ลายเซ็นผู้ตรวจสอบ">
                            </div>
                            <input type="hidden" id="inspectorSignature" required>
                            <button type="button" class="btn btn-clear" id="clearInspectorSignature" style="margin-top: 10px; padding: 8px 15px; font-size: 0.9rem;">
                                <i class="fas fa-eraser"></i> ลบล้างลายเซ็น
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <label for="ownerSignature" class="required">ลายเซ็นเจ้าของ/ผู้จัดการโรงงาน</label>
                            <div class="signature-area" id="ownerSignatureArea">
                                <i class="fas fa-signature"></i>
                                <p>คลิกเพื่อเพิ่มลายเซ็นเจ้าของ/ผู้จัดการ</p>
                                <canvas id="ownerSignatureCanvas" width="400" height="150" style="display:none;"></canvas>
                                <img id="ownerSignaturePreview" class="signature-preview" alt="ลายเซ็นเจ้าของ/ผู้จัดการ">
                            </div>
                            <input type="hidden" id="ownerSignature" required>
                            <button type="button" class="btn btn-clear" id="clearOwnerSignature" style="margin-top: 10px; padding: 8px 15px; font-size: 0.9rem;">
                                <i class="fas fa-eraser"></i> ลบล้างลายเซ็น
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="btn btn-save" id="saveToSheets">
                        <i class="fas fa-save"></i> บันทึกลง Google Sheets
                    </button>
                    <button type="button" class="btn btn-pdf" id="generatePDF">
                        <i class="fas fa-file-pdf"></i> สร้างไฟล์ PDF
                    </button>
                    <button type="button" class="btn btn-clear" id="clearForm">
                        <i class="fas fa-redo"></i> ล้างฟอร์ม
                    </button>
                </div>
                
                <div id="statusMessage" class="status-message"></div>
            </form>
        </div>
    </div>

    <!-- Modal สำหรับลายเซ็น -->
    <div id="signatureModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.7); z-index:1000; justify-content:center; align-items:center;">
        <div style="background-color:white; padding:30px; border-radius:10px; max-width:500px; width:90%;">
            <h3 style="margin-bottom:20px; color:#1e3c72;">เพิ่มลายเซ็น</h3>
            <canvas id="signatureCanvas" width="450" height="200" style="border:1px solid #ccc; background-color:#f9f9f9;"></canvas>
            <div style="margin-top:20px; display:flex; justify-content:space-between;">
                <button type="button" id="clearSignature" style="padding:10px 20px; background-color:#6c757d; color:white; border:none; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-eraser"></i> ล้าง
                </button>
                <button type="button" id="saveSignature" style="padding:10px 20px; background-color:#28a745; color:white; border:none; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-check"></i> บันทึก
                </button>
                <button type="button" id="cancelSignature" style="padding:10px 20px; background-color:#dc3545; color:white; border:none; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-times"></i> ยกเลิก
                </button>
            </div>
        </div>
    </div>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script>
        // ตัวแปรเก็บข้อมูลลายเซ็น
        let currentSignature = null;
        let signatureContext = null;
        let drawing = false;
        let lastX = 0;
        let lastY = 0;
        
        // ข้อมูลสำหรับ Google Apps Script URL (ให้เปลี่ยนเป็น URL ของคุณหลังจาก deploy)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxxHlaFpzHdf-d7GsFkkVegAbtY5_NjLVjOxjwq6GgyR4PwocgRqYPPBQZKPvDTzRGRHw/exec';
        
        document.addEventListener('DOMContentLoaded', function() {
            // ตั้งค่าวันที่เป็นวันนี้
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('inspectionDate').value = today;
            
            // ตั้งค่าวันที่ตรวจสอบครั้งต่อไปเป็นอีก 1 ปี
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            const nextYearFormatted = nextYear.toISOString().split('T')[0];
            document.getElementById('nextInspectionDate').value = nextYearFormatted;
            
            // ตั้งค่าการวาดลายเซ็น
            setupSignatureCanvas();
            
            // ตั้งค่า event listeners
            document.getElementById('inspectorSignatureArea').addEventListener('click', function() {
                openSignatureModal('inspector');
            });
            
            document.getElementById('ownerSignatureArea').addEventListener('click', function() {
                openSignatureModal('owner');
            });
            
            document.getElementById('clearInspectorSignature').addEventListener('click', function() {
                clearSignature('inspector');
            });
            
            document.getElementById('clearOwnerSignature').addEventListener('click', function() {
                clearSignature('owner');
            });
            
            document.getElementById('saveToSheets').addEventListener('click', saveToGoogleSheets);
            document.getElementById('generatePDF').addEventListener('click', generatePDF);
            document.getElementById('clearForm').addEventListener('click', clearForm);
            
            // Event listeners สำหรับลายเซ็นใน modal
            document.getElementById('clearSignature').addEventListener('click', clearSignatureCanvas);
            document.getElementById('saveSignature').addEventListener('click', saveSignature);
            document.getElementById('cancelSignature').addEventListener('click', closeSignatureModal);
        });
        
        function setupSignatureCanvas() {
            const canvas = document.getElementById('signatureCanvas');
            signatureContext = canvas.getContext('2d');
            signatureContext.lineWidth = 2;
            signatureContext.lineCap = 'round';
            signatureContext.strokeStyle = '#000';
            
            // เริ่มต้นวาด
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // สำหรับ touch devices
            canvas.addEventListener('touchstart', startDrawingTouch);
            canvas.addEventListener('touchmove', drawTouch);
            canvas.addEventListener('touchend', stopDrawing);
        }
        
        function startDrawing(e) {
            drawing = true;
            const rect = e.target.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
        }
        
        function startDrawingTouch(e) {
            drawing = true;
            e.preventDefault();
            const rect = e.target.getBoundingClientRect();
            const touch = e.touches[0];
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;
        }
        
        function draw(e) {
            if (!drawing) return;
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            signatureContext.beginPath();
            signatureContext.moveTo(lastX, lastY);
            signatureContext.lineTo(x, y);
            signatureContext.stroke();
            
            lastX = x;
            lastY = y;
        }
        
        function drawTouch(e) {
            if (!drawing) return;
            e.preventDefault();
            const rect = e.target.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            signatureContext.beginPath();
            signatureContext.moveTo(lastX, lastY);
            signatureContext.lineTo(x, y);
            signatureContext.stroke();
            
            lastX = x;
            lastY = y;
        }
        
        function stopDrawing() {
            drawing = false;
        }
        
        function clearSignatureCanvas() {
            const canvas = document.getElementById('signatureCanvas');
            signatureContext.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        function openSignatureModal(type) {
            currentSignature = type;
            document.getElementById('signatureModal').style.display = 'flex';
            clearSignatureCanvas();
        }
        
        function closeSignatureModal() {
            document.getElementById('signatureModal').style.display = 'none';
            currentSignature = null;
        }
        
        function saveSignature() {
            const canvas = document.getElementById('signatureCanvas');
            const dataURL = canvas.toDataURL('image/png');
            
            if (currentSignature === 'inspector') {
                document.getElementById('inspectorSignature').value = dataURL;
                document.getElementById('inspectorSignaturePreview').src = dataURL;
                document.getElementById('inspectorSignaturePreview').style.display = 'block';
                document.getElementById('inspectorSignatureArea').querySelector('p').style.display = 'none';
            } else if (currentSignature === 'owner') {
                document.getElementById('ownerSignature').value = dataURL;
                document.getElementById('ownerSignaturePreview').src = dataURL;
                document.getElementById('ownerSignaturePreview').style.display = 'block';
                document.getElementById('ownerSignatureArea').querySelector('p').style.display = 'none';
            }
            
            closeSignatureModal();
        }
        
        function clearSignature(type) {
            if (type === 'inspector') {
                document.getElementById('inspectorSignature').value = '';
                document.getElementById('inspectorSignaturePreview').src = '';
                document.getElementById('inspectorSignaturePreview').style.display = 'none';
                document.getElementById('inspectorSignatureArea').querySelector('p').style.display = 'block';
            } else if (type === 'owner') {
                document.getElementById('ownerSignature').value = '';
                document.getElementById('ownerSignaturePreview').src = '';
                document.getElementById('ownerSignaturePreview').style.display = 'none';
                document.getElementById('ownerSignatureArea').querySelector('p').style.display = 'block';
            }
        }
        
        function validateForm() {
            const requiredFields = document.querySelectorAll('[required]');
            let isValid = true;
            
            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.style.borderColor = '#dc3545';
                    isValid = false;
                } else {
                    field.style.borderColor = '#ccc';
                }
            }
            
            return isValid;
        }
        
        async function saveToGoogleSheets() {
            if (!validateForm()) {
                showStatus('กรุณากรอกข้อมูลให้ครบทุกช่องที่มีเครื่องหมาย *', 'error');
                return;
            }
            
            // เก็บข้อมูลจากฟอร์ม
            const formData = {
                companyName: document.getElementById('companyName').value,
                companyAddress: document.getElementById('companyAddress').value,
                factoryName: document.getElementById('factoryName').value,
                factoryType: document.getElementById('factoryType').value,
                factorySize: document.getElementById('factorySize').value,
                ownerName: document.getElementById('ownerName').value,
                ownerPosition: document.getElementById('ownerPosition').value,
                inspectorName: document.getElementById('inspectorName').value,
                inspectionDate: document.getElementById('inspectionDate').value,
                nextInspectionDate: document.getElementById('nextInspectionDate').value,
                overallResult: document.getElementById('overallResult').value,
                recommendations: document.getElementById('recommendations').value,
                inspectorSignature: document.getElementById('inspectorSignature').value,
                ownerSignature: document.getElementById('ownerSignature').value
            };
            
            showStatus('กำลังบันทึกข้อมูล...', 'info');
            
            try {
                // ส่งข้อมูลไปยัง Google Apps Script
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus('บันทึกข้อมูลลง Google Sheets เรียบร้อยแล้ว!', 'success');
                } else {
                    showStatus('เกิดข้อผิดพลาดในการบันทึกข้อมูล: ' + result.message, 'error');
                }
            } catch (error) {
                showStatus('เกิดข้อผิดพลาดในการเชื่อมต่อ: ' + error.message, 'error');
            }
        }
        
        function generatePDF() {
            if (!validateForm()) {
                showStatus('กรุณากรอกข้อมูลให้ครบทุกช่องที่มีเครื่องหมาย *', 'error');
                return;
            }
            
            showStatus('กำลังสร้างไฟล์ PDF...', 'info');
            
            // สร้าง PDF โดยใช้ jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // ตั้งค่าข้อมูลพื้นฐาน
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            let yPos = margin;
            
            // ส่วนหัว
            doc.setFontSize(16);
            doc.setFont("helvetica", "bold");
            doc.text("แบบรายงานการตรวจสอบและรับรองความปลอดภัยของระบบไฟฟ้าในโรงงาน", pageWidth / 2, yPos, { align: 'center' });
            yPos += 10;
            
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text("กรมโรงงานอุตสาหกรรม กระทรวงอุตสาหกรรม", pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;
            
            // ข้อมูลทั่วไป
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("ข้อมูลทั่วไป", margin, yPos);
            yPos += 10;
            
            doc.setFontSize(11);
            doc.setFont("helvetica", "normal");
            doc.text(`ชื่อบริษัท/โรงงาน: ${document.getElementById('companyName').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ที่อยู่: ${document.getElementById('companyAddress').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ชื่อโรงงานที่ตรวจสอบ: ${document.getElementById('factoryName').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ประเภทธุรกิจ: ${document.getElementById('factoryType').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ขนาดพื้นที่โรงงาน: ${document.getElementById('factorySize').value} ตารางเมตร`, margin, yPos);
            yPos += 7;
            
            doc.text(`ชื่อเจ้าของ/ผู้จัดการ: ${document.getElementById('ownerName').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ตำแหน่ง: ${document.getElementById('ownerPosition').value}`, margin, yPos);
            yPos += 15;
            
            // ข้อมูลการตรวจสอบ
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("ข้อมูลการตรวจสอบ", margin, yPos);
            yPos += 10;
            
            doc.setFontSize(11);
            doc.setFont("helvetica", "normal");
            doc.text(`ผู้ตรวจสอบ: ${document.getElementById('inspectorName').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`วันที่ตรวจสอบ: ${formatDate(document.getElementById('inspectionDate').value)}`, margin, yPos);
            yPos += 7;
            
            doc.text(`วันที่ตรวจสอบครั้งต่อไป: ${formatDate(document.getElementById('nextInspectionDate').value)}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ผลการตรวจสอบโดยรวม: ${document.getElementById('overallResult').value}`, margin, yPos);
            yPos += 7;
            
            doc.text(`ข้อเสนอแนะ/สิ่งที่ต้องปรับปรุง:`, margin, yPos);
            yPos += 5;
            
            const recommendations = doc.splitTextToSize(document.getElementById('recommendations').value, pageWidth - 2*margin);
            doc.text(recommendations, margin, yPos);
            yPos += recommendations.length * 5 + 15;
            
            // ลายเซ็น
            doc.setFontSize(14);
            doc.setFont("helvetica", "bold");
            doc.text("ลายเซ็นรับรอง", pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;
            
            // ลายเซ็นผู้ตรวจสอบ
            doc.setFontSize(11);
            doc.setFont("helvetica", "normal");
            doc.text("ลายเซ็นผู้ตรวจสอบ", margin + 40, yPos);
            
            // ลายเซ็นเจ้าของ/ผู้จัดการ
            doc.text("ลายเซ็นเจ้าของ/ผู้จัดการโรงงาน", pageWidth - margin - 40, yPos, { align: 'right' });
            yPos += 25;
            
            // เพิ่มลายเซ็นภาพถ้ามี
            try {
                if (document.getElementById('inspectorSignature').value) {
                    const inspectorSigData = document.getElementById('inspectorSignature').value;
                    doc.addImage(inspectorSigData, 'PNG', margin, yPos - 20, 50, 20);
                }
                
                if (document.getElementById('ownerSignature').value) {
                    const ownerSigData = document.getElementById('ownerSignature').value;
                    doc.addImage(ownerSigData, 'PNG', pageWidth - margin - 50, yPos - 20, 50, 20);
                }
            } catch (e) {
                console.log("ไม่สามารถเพิ่มลายเซ็นใน PDF: ", e);
            }
            
            yPos += 10;
            
            doc.text(`(${document.getElementById('inspectorName').value})`, margin + 40, yPos);
            doc.text(`(${document.getElementById('ownerName').value})`, pageWidth - margin - 40, yPos, { align: 'right' });
            yPos += 5;
            
            doc.text("ผู้ตรวจสอบ", margin + 40, yPos);
            doc.text("เจ้าของ/ผู้จัดการโรงงาน", pageWidth - margin - 40, yPos, { align: 'right' });
            
            // บันทึก PDF
            doc.save(`รายงานตรวจสอบระบบไฟฟ้า_${document.getElementById('factoryName').value}_${new Date().toISOString().slice(0,10)}.pdf`);
            
            showStatus('สร้างไฟล์ PDF เรียบร้อยแล้ว!', 'success');
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function clearForm() {
            if (confirm('คุณต้องการล้างข้อมูลทั้งหมดในฟอร์มหรือไม่?')) {
                document.getElementById('inspectionForm').reset();
                
                // รีเซ็ตลายเซ็น
                clearSignature('inspector');
                clearSignature('owner');
                
                // ตั้งค่าวันที่ใหม่
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('inspectionDate').value = today;
                
                const nextYear = new Date();
                nextYear.setFullYear(nextYear.getFullYear() + 1);
                const nextYearFormatted = nextYear.toISOString().split('T')[0];
                document.getElementById('nextInspectionDate').value = nextYearFormatted;
                
                showStatus('ล้างฟอร์มเรียบร้อยแล้ว', 'success');
            }
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            statusDiv.style.display = 'block';
            
            // ซ่อนข้อความหลังจาก 5 วินาที
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
